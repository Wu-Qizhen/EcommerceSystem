# 简易电商系统技术报告

## 1. 项目概述

### 1.1 项目背景
本项目是一个基于 C 语言开发的简易电商系统，采用模块化设计理念，模拟了较为完整的电子商务功能。系统分为商户端和客户端两大模块，分别服务于商家和消费者，提供了从商品上架、促销管理到购物下单的解决方案。

### 1.2 设计目标
- **功能完整性**：覆盖商品管理、促销活动、购物车、订单处理等核心电商功能
- **用户体验**：提供较为清晰直观的控制台操作界面
- **数据安全**：实现用户密码加密存储和输入验证
- **系统稳定**：采用文件持久化存储，确保数据可靠性
- **扩展性**：模块化设计便于功能扩展和维护

### 1.3 技术栈
- **开发语言**：C 语言
- **开发环境**：Windows 平台，支持中文显示
- **数据存储**：二进制文件持久化



## 2. 系统架构设计

### 2.1 整体架构

- 核心数据层
  - 用户数据（公共）
  - 商品数据（公共）
  - 订单数据
  - 购物车数据
  - 折扣数据
- 商户端系统
  - 商品管理
  - 折扣管理
  - 库存管理
- 客户端系统
  - 商品浏览
  - 购物车
  - 订单管理

### 2.2 模块划分
- **认证、用户模块**：用户认证、个人信息维护
- **工具、安全模块**：界面渲染、输入验证、加密安全
- **商品模块**：商品管理、库存管理、分类检索
- **折扣模块**：促销活动创建、状态管理、价格计算
- **购物车模块**：商品添加、数量修改、结算处理
- **订单模块**：订单创建、状态跟踪、取消处理



## 3. 核心功能接口与数据结构设计

### 3.1 商户端功能
#### 3.1.1 商品生命周期管理
```c
typedef struct {
    int id;
    char name[MAX_NAME_LEN];
    char category[MAX_CATEGORY_LEN];
    char description[MAX_DESC_LEN];
    double price;
    int stock;
    int merchantId;
    int isActive;
    int isDeleted;
} Product;

extern Product products[MAX_PRODUCTS];
extern int productCount;
extern Product *currentProduct;

void loadProducts();

void saveProducts();

int findProductById(int id);

int findProductByName(int merchantId, const char *name);

int findProductsByMerchantIdActive(int merchantId, Product result[]);

int findProductsByMerchantIdAll(int merchantId, Product result[]);

int findProductsByMerchantIdActiveLimitCount(int merchantId, Product result[], int maxResults);

int searchProducts(const char *keyword, Product result[], int maxResults);

void displayProductInfo(const Product *product);

void displayCurrentProductInfo();

void displayCurrentProductInfoById(int productId);

void addProduct(int merchantId);

void queryProducts(int merchantId);

void manageProductStatus(int merchantId);

int activeProduct(int productId);

int unactiveProduct(int productId);

int toggleProductStatus(int productId);
```

#### 3.1.2 折扣系统
```c
typedef struct {
    int id;
    int merchantId;
    char name[MAX_NAME_LEN];
    int type;
    double discountRate;
    double minAmount;
    double discountAmount;

    time_t startTime;
    time_t endTime;
    int isActive;
    int isDeleted;
} Discount;

extern Discount discounts[MAX_DISCOUNTS];
extern int discountCount;
extern const char *DISCOUNT_DATA_FILE;

void loadDiscounts();

void saveDiscounts();

int findDiscountById(int id);

int findDiscountsByMerchantId(int merchantId, Discount result[]);

int findActiveDiscountsByMerchantId(int merchantId, Discount result[]);

void displayDiscountDetails(const Discount *discount);

void displayDiscountsByMerchantId(Discount result[], int count);

void addDiscount(int merchantId);

void queryDiscounts(int merchantId);

void manageDiscountStatus(int merchantId);

int activeDiscount(int discountId);

int unactiveDiscount(int discountId);

int toggleDiscountStatus(int discountId);

double calculateDiscountedPrice(double originalPrice, const Discount *discount);

int isValidDiscount(const Discount *discount);
```

### 3.2 客户端功能
#### 3.2.1 商品检索系统
```c
void browseProductsByCategory(void);

void browseProductsByPrice(void);

void searchProductsForClient(void);

void viewProductDetailsForClient(void);

void displayProductsForClient(Product result[], int count);

void displayProductDetailsForClient(const Product *product);
```

#### 3.2.2 购物车与订单流水线
```c
typedef struct {
    int productId;
    char productName[MAX_NAME_LEN];
    double price;
    int quantity;
    int merchantId;
} CartItem;

typedef struct {
    int userId;
    CartItem items[MAX_CART_ITEMS];
    int itemCount;
    double totalAmount;
} Cart;

extern Cart currentCart;
extern const char *CART_DATA_FILE;

void loadCart(int userId);

void saveCart(void);

void displayCart(void);

void addToCart(void);

void updateCartItemQuantity(void);

void removeFromCart(void);

void clearCart(void);

void checkoutCart(void);

double calculateCartTotal(void);

int findCartItemByProductId(int productId);

typedef struct {
    int productId;
    char productName[MAX_NAME_LEN];
    double price;
    int quantity;
    int merchantId;
} OrderItem;

typedef struct {
    int id;
    int userId;
    OrderItem items[MAX_ORDER_ITEMS];
    int itemCount;
    double totalAmount;
    char address[MAX_ADDRESS_LEN];
    time_t createTime;
    int status;
} Order;

extern Order orders[MAX_ORDERS];
extern int orderCount;
extern const char *ORDER_DATA_FILE;

void loadOrders(void);

void saveOrders(void);

void createOrderFromCart(const char *address, double totalAmount);

void viewAllOrders(void);

void viewPendingOrders(void);

void viewPaidOrders(void);

void cancelOrder(void);

void viewOrderDetails(void);

void displayOrder(const Order *order);

int findOrderById(int orderId);

int findOrdersByUserId(int userId, Order result[]);
```



## 4. 安全机制实现

### 4.1 数据加密
```c
// 异或加密的可逆性
void encryptPassword(char *password) {
    const char key = 0x55;
    const int len = strlen(password);
    for (int i = 0; i < len; i++) {
        password[i] = password[i] ^ key;
    }
}

void decryptPassword(char *password) {
    encryptPassword(password);
}
```

### 4.2 输入验证
```c
int validateUserName(const char *name);

int validateAccount(const char *account);

int validatePhone(const char *phone);

int validateBirth(const char *birth);

int validatePassword(const char *password);

int validateProductName(const char *name);

int validateCategory(const char *category);

int validateDescription(const char *description);

int validatePrice(double price);

int validateStock(int stock);
```



## 5. 用户界面设计

### 5.1 控制台界面渲染框架
```c
void printHeader(char *title) {
    printLine();
    printTitle(title);
    printLine();
}

void printSubHeader(char *title) {
    printSubLine();
    printTitle(title);
    printSubLine();
}

void printTitle(char *title) {
    const int totalLength = 80;
    int titleLength = 0;
    const char *ptr = title;

    while (*ptr != '\0') {
        titleLength++;
        ptr++;
    }

    const int padding = (totalLength - titleLength - 2) / 2;

    for (int i = 0; i < padding; i++) {
        printf(" ");
    }

    printf(" %s ", title);

    printf("\n");
}

void printPlusLine() {
    printf("++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n");
}

void printStarLine() {
    printf("********************************************************************************\n");
}

void printLine() {
    printf("================================================================================\n");
}

void printSubLine() {
    printf("--------------------------------------------------------------------------------\n");
}

void printInputHint() {
    printf("请选择操作：");
}

void printWarning(char *warning) {
    printStarLine();
    printf("⚠️ %s\n", warning);
    printStarLine();
    pauseScreen();
}

void printError(char *err) {
    printStarLine();
    printf("❌ %s\n", err);
    printStarLine();
    pauseScreen();
}

void printSuccess(char *msg) {
    printPlusLine();
    printf("✅ %s\n", msg);
    printPlusLine();
    pauseScreen();
}

int getDisplayWidth(const char *str) {
    int width = 0;
    while (*str) {
        if ((*str & 0xC0) != 0x80) {
            if ((unsigned char) *str >= 0x80) {
                // 中文字符
                width += 2;
            } else {
                // 英文字符
                width += 1;
            }
        }
        str++;
    }
    return width;
}

void printPadded(const char *str, const int targetWidth) {
    const int actualWidth = getDisplayWidth(str);
    printf("%s", str);
    for (int i = 0; i < targetWidth - actualWidth; i++) {
        printf(" ");
    }
}
```

### 7.2 导航系统
```c
// 面包屑导航
void showDiscountManagementMenu(const int merchantId) {
    printHeader("优惠政策");
    printf("商品概览 > 优惠政策\n");
    printSubLine();
    printf("0. 返回上级菜单\n");
    printf("1. 添加折扣活动\n");
    // ...
}
```



## 6. 数据持久化方案

### 6.1 文件存储策略
```c
const char *USER_DATA_FILE = "D:\\MyProjects\\CPP\\EcommerceSystem\\data\\users.dat";
const char *PRODUCT_DATA_FILE = "D:\\MyProjects\\CPP\\EcommerceSystem\\data\\products.dat";
const char *ORDER_DATA_FILE = "D:\\MyProjects\\CPP\\EcommerceSystem\\data\\orders.dat";

void saveUsers(void) {
    FILE *file = fopen(USER_DATA_FILE, "wb");
    if (file == NULL) {
        printError("无法保存用户数据！");
        return;
    }
    
    for (int i = 0; i < userCount; i++) {
        encryptPassword(users[i].password);
    }
    
    fwrite(&userCount, sizeof(int), 1, file);
    for (int i = 0; i < userCount; i++) {
        fwrite(&users[i], sizeof(User), 1, file);
    }
    
    for (int i = 0; i < userCount; i++) {
        decryptPassword(users[i].password);
    }
    
    fclose(file);
}
```



## 7. 总结与展望

### 7.1 项目成果与价值
本项目成功模拟了一个功能较为完整的电商系统，具备商品管理、促销活动、购物车、订单处理等核心功能模拟。系统采用模块化设计，代码结构清晰，具有良好的可维护性和扩展性。

本系统是一个优秀的 C 语言练手项目，助我成功从 Kotlin、Java 等语言快速转型、领悟了 C 语言面向过程的编程思想。